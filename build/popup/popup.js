"use strict";const state={token:"",user:null};chrome.storage.sync.get(["ml_token"],e=>{state.token=e.ml_token});const attachmentBtn=document.getElementById("choose_attachment"),attachmentInput=document.getElementById("attachment_input"),attachment=document.getElementById("attachment"),contentInput=document.getElementById("content"),submitBtn=document.getElementById("submit"),logoutBtn=document.getElementById("logout");function sendMessage(e,t){t||(t={}),t.action=e,chrome.runtime.sendMessage(t)}function setProfile(e,t){state.user=t,document.getElementById("header").src=t.header,document.getElementById("avatar").src=t.avatar,document.querySelector("#name h1").innerHTML=t.name,document.getElementById("streak").innerHTML=t.streak,document.getElementById("score").innerHTML=t.maker_score,document.getElementById("claps").innerHTML=t.praise_received,document.getElementById("rest_days").innerHTML=t.rest_day_balance}function isLoading(e){e?(submitBtn.loading=!0,submitBtn.querySelector(".loader").style.display="block",submitBtn.querySelector("span").style.display="none",submitBtn.querySelector("svg").style.display="none"):(submitBtn.loading=!1,submitBtn.querySelector(".loader").style.display="none",submitBtn.querySelector("span").style.display="block",submitBtn.querySelector("svg").style.display="block")}function newTask(e){let t=!0,n=!1;if(e.startsWith("/todo ")?(t=!1,n=!1,e=e.replace("/todo ","")):e.startsWith("/doing ")?(t=!1,n=!0,e=e.replace("/doing ","")):e=e.replace("/done ",""),!e)return;isLoading(!0);const s=new FormData;s.append("content",e),s.append("in_progress",n),s.append("done",t),attachmentInput.files&&attachmentInput.files[0]&&s.append("attachment",attachmentInput.files[0]),fetch("https://api.getmakerlog.com/tasks/",{method:"POST",headers:{Authorization:`Token ${state.token}`},body:s}).then(e=>e.json()).then(e=>{e.id?contentInput.value="":alert("Something went wrong!"),isLoading(!1)}).catch(e=>{alert(e.message),isLoading(!1)})}document.getElementById("name").addEventListener("click",()=>sendMessage("Tab.open",{url:`https://getmakerlog.com/@${state.user.username}`})),document.querySelector("#discuss").addEventListener("click",()=>sendMessage("Tab.open",{url:"https://getmakerlog.com/discussions"})),document.querySelector("#stories").addEventListener("click",()=>sendMessage("Tab.open",{url:"https://getmakerlog.com/stories"})),document.querySelector("#explore").addEventListener("click",()=>sendMessage("Tab.open",{url:"https://getmakerlog.com/"})),document.querySelector("#coffee").addEventListener("click",()=>sendMessage("Tab.open",{url:"https://www.buymeacoffee.com/zicsus"})),logoutBtn.addEventListener("click",()=>{sendMessage("Manager.logout",{}),window.close()}),attachmentBtn.addEventListener("click",e=>{attachmentInput.click()}),attachmentInput.addEventListener("change",e=>{if(attachmentInput.files&&attachmentInput.files[0]){let e=new FileReader;e.onload=e=>{attachment.src=e.target.result,setTimeout(()=>{const e=document.querySelector(".main"),t=attachment.clientHeight;e.setAttribute("style",`height:${270+t}px`)},100)},e.readAsDataURL(attachmentInput.files[0])}}),submitBtn.addEventListener("click",()=>{if(!submitBtn.loading||!state.token){newTask(contentInput.value)}}),contentInput.addEventListener("keyup",e=>{if(!(13!==e.which&&"Enter"!==e.key&&"Enter"!==e.code||submitBtn.loading&&state.token)){newTask(contentInput.value)}}),chrome.runtime.onMessage.addListener((e,t,n)=>{switch(e.action){case"Auth.set":sendMessage("Api.getProfile");break;case"Api.setProfile":setProfile(e.err,e.data)}}),sendMessage("Auth.check");