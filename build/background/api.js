"use strict";const Api=function(){const e="https://api.getmakerlog.com";let n="",o=null;return chrome.storage.sync.get(["ml_token","user"],e=>{n=e.ml_token,o=e.user}),{getProfile:function(t){o&&t(null,o),fetch(`${e}/me/`,{method:"GET",headers:{Authorization:`Token ${n}`,"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>e.json()).then(a=>{!function(o,t){fetch(`${e}/users/${o}/stats`,{method:"GET",headers:{Authorization:`Token ${n}`,"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>e.json()).then(e=>{t(null,e)}).catch(e=>{console.log(e),t(e,null)})}(a.username,(e,n)=>{e&&t(e,null);const s={username:a.username,name:`${a.first_name} ${a.last_name}`,avatar:a.avatar,header:a.header,remaining_tasks:n.remaining_tasks,done_today:n.done_today,streak:n.streak,praise_received:n.praise_received,maker_score:n.maker_score,rest_day_balance:n.rest_day_balance};chrome.storage.sync.set({user:s},()=>{o=s}),t(null,s)})}).catch(e=>{console.log(e),t(e,null)})},setToken:function(e){n=e,chrome.storage.sync.set({ml_token:e},()=>{console.log("Login successfull!")})},newTask:function(o,t,a,s,r){console.log(s);const c=new FormData;c.append("content",o),c.append("in_progress",a),c.append("done",t),s&&c.append("attachment",s),fetch(`${e}/tasks/`,{method:"POST",headers:{Authorization:`Token ${n}`},body:c}).then(e=>e.json()).then(e=>{console.log(e),r(null,e)}).catch(e=>{console.log(e),r(e,null)})}}}();